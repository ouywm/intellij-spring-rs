use serde::Serialize;
use ${entityModulePath}::${moduleName};
#if($voNeedsUuid)
use sea_orm::prelude::Uuid;
#end
#if($voNeedsJson)
use sea_orm::prelude::Json;
#end
#if($voNeedsDecimal)
use rust_decimal::Decimal;
#end
#if($addBon)
use bon::Builder;
#end
#if($addJsonSchema)
use schemars::JsonSchema;
#end
#if($tableComment != "")

/// ${tableComment} — API response view object.
///
/// DateTime/Uuid/Decimal fields are converted to `String` for JSON serialization & JsonSchema compatibility.
#else

/// View object for `${tableName}` — used in API responses.
///
/// DateTime/Uuid/Decimal fields are converted to `String` for JSON serialization & JsonSchema compatibility.
#end
#[derive(${voBaseDerives}#if($extraDerives != ""), ${extraDerives}#end)]
pub struct $voName {
#foreach($column in $columns)
#if($column.comment != "")
    /// $column.comment
#end
    pub $column.fieldName: $column.voRustType,
#end
}

/// Convert Entity `Model` → `${voName}` for API responses.
///
/// Type conversions:
/// - `DateTime`/`DateTimeWithTimeZone` → `String` (ISO 8601 format)
/// - `Uuid` → `String` (hyphenated format)
/// - `Decimal` → `String` (preserves precision)
/// - `Json` → `String` (JSON string)
impl From<${moduleName}::Model> for $voName {
    fn from(model: ${moduleName}::Model) -> Self {
        Self {
#foreach($column in $columns)
#if($column.isVoVecConvertType && $column.isNullable)
## Option<Vec<T>> → Option<Vec<String>>
            $column.fieldName: model.${column.fieldName}.map(#[[|v| v.into_iter().map(|x| x.to_string()).collect())]]#,
#elseif($column.isVoVecConvertType)
## Vec<T> → Vec<String>
            $column.fieldName: model.${column.fieldName}.into_iter().map(#[[|x| x.to_string()]]#).collect(),
#elseif($column.isVoConvertType && $column.isNullable)
## Velocity needs #[[ ]]# to escape Rust closure |v| syntax
            $column.fieldName: model.${column.fieldName}.map(#[[|v| v.to_string()]]#),
#elseif($column.isVoConvertType)
            $column.fieldName: model.${column.fieldName}.to_string(),
#else
            $column.fieldName: model.${column.fieldName},
#end
#end
        }
    }
}
